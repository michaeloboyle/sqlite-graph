<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>sqlite-graph Interactive Visualization</title>
  <script type="text/javascript" src="https://unpkg.com/vis-network@9.1.6/standalone/umd/vis-network.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
    }

    .description {
      color: #666;
      line-height: 1.6;
    }

    .controls {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }

    button:hover {
      background: #0056b3;
    }

    button.secondary {
      background: #6c757d;
    }

    button.secondary:hover {
      background: #545b62;
    }

    #mynetwork {
      width: 100%;
      height: 700px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .info-panel {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .info-panel h3 {
      margin-bottom: 10px;
      color: #333;
    }

    .node-details {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      margin-top: 10px;
    }

    .node-details pre {
      margin: 10px 0 0 0;
      padding: 10px;
      background: white;
      border-radius: 4px;
      overflow-x: auto;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .stat-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      text-align: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: #007bff;
    }

    .stat-label {
      color: #666;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üó∫Ô∏è sqlite-graph Interactive Visualization</h1>
      <p class="description">
        Explore your graph database visually with interactive node and edge manipulation.
        Click nodes to see details, drag to rearrange, and use the controls to load different example datasets.
      </p>
    </header>

    <div class="controls">
      <div class="button-group">
        <button onclick="loadJobSearchGraph()">Load Job Search Graph</button>
        <button onclick="loadSocialNetwork()">Load Social Network</button>
        <button onclick="loadKnowledgeGraph()">Load Knowledge Graph</button>
        <button onclick="loadDependencyGraph()">Load Dependency Graph</button>
        <button class="secondary" onclick="resetView()">Reset View</button>
        <button class="secondary" onclick="fitNetwork()">Fit to Screen</button>
      </div>
    </div>

    <div id="mynetwork"></div>

    <div class="info-panel">
      <h3>Graph Statistics</h3>
      <div class="stats">
        <div class="stat-card">
          <div class="stat-value" id="nodeCount">0</div>
          <div class="stat-label">Nodes</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="edgeCount">0</div>
          <div class="stat-label">Edges</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="selectedNode">None</div>
          <div class="stat-label">Selected Node</div>
        </div>
      </div>

      <div id="nodeDetails" class="node-details" style="display: none;">
        <h4>Node Details</h4>
        <pre id="nodeDetailsContent"></pre>
      </div>
    </div>
  </div>

  <script>
    // Initialize vis.js network
    let network;
    let nodes, edges;

    const options = {
      nodes: {
        shape: 'dot',
        size: 20,
        font: {
          size: 14,
          color: '#333'
        },
        borderWidth: 2,
        shadow: true
      },
      edges: {
        width: 2,
        color: { color: '#848484', highlight: '#007bff' },
        smooth: {
          type: 'continuous'
        },
        arrows: {
          to: { enabled: true, scaleFactor: 0.5 }
        },
        font: {
          size: 12,
          align: 'middle'
        }
      },
      physics: {
        stabilization: { iterations: 200 },
        barnesHut: {
          gravitationalConstant: -8000,
          springConstant: 0.04,
          springLength: 150
        }
      },
      interaction: {
        hover: true,
        tooltipDelay: 200,
        navigationButtons: true,
        keyboard: true
      }
    };

    // Color schemes for different node types
    const nodeColors = {
      Job: { background: '#4CAF50', border: '#388E3C' },
      Company: { background: '#2196F3', border: '#1976D2' },
      Skill: { background: '#FF9800', border: '#F57C00' },
      Person: { background: '#9C27B0', border: '#7B1FA2' },
      Document: { background: '#00BCD4', border: '#0097A7' },
      Topic: { background: '#FFEB3B', border: '#FBC02D' },
      Package: { background: '#795548', border: '#5D4037' },
      User: { background: '#E91E63', border: '#C2185B' },
      Post: { background: '#3F51B5', border: '#303F9F' }
    };

    function initNetwork() {
      const container = document.getElementById('mynetwork');
      nodes = new vis.DataSet([]);
      edges = new vis.DataSet([]);
      const data = { nodes, edges };
      network = new vis.Network(container, data, options);

      // Event listeners
      network.on('selectNode', onNodeSelect);
      network.on('deselectNode', onNodeDeselect);
      network.on('stabilizationIterationsDone', () => {
        network.setOptions({ physics: false });
      });
    }

    function onNodeSelect(params) {
      if (params.nodes.length > 0) {
        const nodeId = params.nodes[0];
        const node = nodes.get(nodeId);
        document.getElementById('selectedNode').textContent = node.label;
        document.getElementById('nodeDetails').style.display = 'block';
        document.getElementById('nodeDetailsContent').textContent = JSON.stringify(node.properties, null, 2);
      }
    }

    function onNodeDeselect() {
      document.getElementById('selectedNode').textContent = 'None';
      document.getElementById('nodeDetails').style.display = 'none';
    }

    function updateStats() {
      document.getElementById('nodeCount').textContent = nodes.length;
      document.getElementById('edgeCount').textContent = edges.length;
    }

    function loadJobSearchGraph() {
      nodes.clear();
      edges.clear();

      // Create nodes
      const jobNodes = [
        { id: 1, label: 'Senior Engineer', type: 'Job', properties: { salary: 150000, remote: true } },
        { id: 2, label: 'Tech Lead', type: 'Job', properties: { salary: 180000, remote: false } },
        { id: 3, label: 'Staff Engineer', type: 'Job', properties: { salary: 200000, remote: true } }
      ];

      const companyNodes = [
        { id: 4, label: 'Google', type: 'Company', properties: { size: 'large', industry: 'Tech' } },
        { id: 5, label: 'Startup X', type: 'Company', properties: { size: 'small', industry: 'SaaS' } }
      ];

      const skillNodes = [
        { id: 6, label: 'TypeScript', type: 'Skill', properties: { category: 'Language' } },
        { id: 7, label: 'React', type: 'Skill', properties: { category: 'Framework' } },
        { id: 8, label: 'Node.js', type: 'Skill', properties: { category: 'Runtime' } },
        { id: 9, label: 'PostgreSQL', type: 'Skill', properties: { category: 'Database' } }
      ];

      const personNodes = [
        { id: 10, label: 'Alice', type: 'Person', properties: { experience: 8 } },
        { id: 11, label: 'Bob', type: 'Person', properties: { experience: 5 } }
      ];

      // Add nodes with colors
      [...jobNodes, ...companyNodes, ...skillNodes, ...personNodes].forEach(node => {
        nodes.add({
          id: node.id,
          label: node.label,
          title: `${node.type}: ${node.label}`,
          color: nodeColors[node.type],
          properties: node.properties,
          type: node.type
        });
      });

      // Create edges
      edges.add([
        { from: 1, to: 4, label: 'POSTED_BY', arrows: 'to' },
        { from: 2, to: 4, label: 'POSTED_BY', arrows: 'to' },
        { from: 3, to: 5, label: 'POSTED_BY', arrows: 'to' },
        { from: 1, to: 6, label: 'REQUIRES', arrows: 'to' },
        { from: 1, to: 7, label: 'REQUIRES', arrows: 'to' },
        { from: 2, to: 6, label: 'REQUIRES', arrows: 'to' },
        { from: 2, to: 8, label: 'REQUIRES', arrows: 'to' },
        { from: 3, to: 6, label: 'REQUIRES', arrows: 'to' },
        { from: 3, to: 9, label: 'REQUIRES', arrows: 'to' },
        { from: 10, to: 6, label: 'HAS_SKILL', arrows: 'to' },
        { from: 10, to: 7, label: 'HAS_SKILL', arrows: 'to' },
        { from: 11, to: 6, label: 'HAS_SKILL', arrows: 'to' },
        { from: 10, to: 1, label: 'APPLIED_TO', arrows: 'to' },
        { from: 11, to: 3, label: 'APPLIED_TO', arrows: 'to' },
        { from: 1, to: 2, label: 'SIMILAR_TO', arrows: 'to' }
      ]);

      updateStats();
      network.fit();
    }

    function loadSocialNetwork() {
      nodes.clear();
      edges.clear();

      const users = [
        { id: 1, label: 'Alice', type: 'User', properties: { age: 28 } },
        { id: 2, label: 'Bob', type: 'User', properties: { age: 32 } },
        { id: 3, label: 'Charlie', type: 'User', properties: { age: 25 } },
        { id: 4, label: 'Diana', type: 'User', properties: { age: 30 } },
        { id: 5, label: 'Eve', type: 'User', properties: { age: 27 } }
      ];

      const posts = [
        { id: 6, label: 'Post 1', type: 'Post', properties: { likes: 42 } },
        { id: 7, label: 'Post 2', type: 'Post', properties: { likes: 18 } },
        { id: 8, label: 'Post 3', type: 'Post', properties: { likes: 91 } }
      ];

      [...users, ...posts].forEach(node => {
        nodes.add({
          id: node.id,
          label: node.label,
          title: `${node.type}: ${node.label}`,
          color: nodeColors[node.type],
          properties: node.properties,
          type: node.type
        });
      });

      edges.add([
        { from: 1, to: 2, label: 'FOLLOWS', arrows: 'to' },
        { from: 1, to: 3, label: 'FOLLOWS', arrows: 'to' },
        { from: 2, to: 4, label: 'FOLLOWS', arrows: 'to' },
        { from: 3, to: 4, label: 'FOLLOWS', arrows: 'to' },
        { from: 4, to: 5, label: 'FOLLOWS', arrows: 'to' },
        { from: 5, to: 1, label: 'FOLLOWS', arrows: 'to' },
        { from: 1, to: 6, label: 'CREATED', arrows: 'to' },
        { from: 2, to: 7, label: 'CREATED', arrows: 'to' },
        { from: 4, to: 8, label: 'CREATED', arrows: 'to' },
        { from: 2, to: 6, label: 'LIKED', arrows: 'to' },
        { from: 3, to: 6, label: 'LIKED', arrows: 'to' },
        { from: 3, to: 8, label: 'LIKED', arrows: 'to' },
        { from: 5, to: 8, label: 'LIKED', arrows: 'to' }
      ]);

      updateStats();
      network.fit();
    }

    function loadKnowledgeGraph() {
      nodes.clear();
      edges.clear();

      const topics = [
        { id: 1, label: 'Databases', type: 'Topic', properties: { category: 'Technology' } },
        { id: 2, label: 'Graph Theory', type: 'Topic', properties: { category: 'Math' } },
        { id: 3, label: 'Algorithms', type: 'Topic', properties: { category: 'CS' } },
        { id: 4, label: 'Data Structures', type: 'Topic', properties: { category: 'CS' } }
      ];

      const docs = [
        { id: 5, label: 'SQLite Docs', type: 'Document', properties: { pages: 100 } },
        { id: 6, label: 'Graph DB Paper', type: 'Document', properties: { pages: 20 } },
        { id: 7, label: 'BFS Algorithm', type: 'Document', properties: { pages: 5 } },
        { id: 8, label: 'Tree Structures', type: 'Document', properties: { pages: 15 } }
      ];

      [...topics, ...docs].forEach(node => {
        nodes.add({
          id: node.id,
          label: node.label,
          title: `${node.type}: ${node.label}`,
          color: nodeColors[node.type],
          properties: node.properties,
          type: node.type
        });
      });

      edges.add([
        { from: 1, to: 5, label: 'DOCUMENTED_IN', arrows: 'to' },
        { from: 2, to: 6, label: 'DOCUMENTED_IN', arrows: 'to' },
        { from: 3, to: 7, label: 'DOCUMENTED_IN', arrows: 'to' },
        { from: 4, to: 8, label: 'DOCUMENTED_IN', arrows: 'to' },
        { from: 1, to: 2, label: 'RELATES_TO', arrows: 'to' },
        { from: 2, to: 3, label: 'RELATES_TO', arrows: 'to' },
        { from: 3, to: 4, label: 'RELATES_TO', arrows: 'to' },
        { from: 4, to: 3, label: 'DEPENDS_ON', arrows: 'to' }
      ]);

      updateStats();
      network.fit();
    }

    function loadDependencyGraph() {
      nodes.clear();
      edges.clear();

      const packages = [
        { id: 1, label: 'sqlite-graph', type: 'Package', properties: { version: '0.1.0' } },
        { id: 2, label: 'better-sqlite3', type: 'Package', properties: { version: '11.0.0' } },
        { id: 3, label: 'typescript', type: 'Package', properties: { version: '5.3.0' } },
        { id: 4, label: 'jest', type: 'Package', properties: { version: '29.7.0' } },
        { id: 5, label: 'ts-jest', type: 'Package', properties: { version: '29.1.0' } },
        { id: 6, label: '@types/node', type: 'Package', properties: { version: '20.10.0' } }
      ];

      packages.forEach(node => {
        nodes.add({
          id: node.id,
          label: node.label,
          title: `${node.type}: ${node.label}\nv${node.properties.version}`,
          color: nodeColors[node.type],
          properties: node.properties,
          type: node.type
        });
      });

      edges.add([
        { from: 1, to: 2, label: 'DEPENDS_ON', arrows: 'to' },
        { from: 1, to: 3, label: 'DEV_DEPENDS', arrows: 'to' },
        { from: 1, to: 4, label: 'DEV_DEPENDS', arrows: 'to' },
        { from: 4, to: 5, label: 'DEPENDS_ON', arrows: 'to' },
        { from: 5, to: 3, label: 'PEER_DEPENDS', arrows: 'to' },
        { from: 1, to: 6, label: 'DEV_DEPENDS', arrows: 'to' }
      ]);

      updateStats();
      network.fit();
    }

    function resetView() {
      network.moveTo({
        position: { x: 0, y: 0 },
        scale: 1,
        animation: {
          duration: 1000,
          easingFunction: 'easeInOutQuad'
        }
      });
    }

    function fitNetwork() {
      network.fit({
        animation: {
          duration: 1000,
          easingFunction: 'easeInOutQuad'
        }
      });
    }

    // Initialize on page load
    window.onload = () => {
      initNetwork();
      loadJobSearchGraph();
    };
  </script>
</body>
</html>
